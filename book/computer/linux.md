# Linux

Linux 英文解释为 Linux is not Unix。

Linux 内核最初只是由芬兰人林纳斯·托瓦兹（Linus Torvalds）在赫尔辛基大学上学时出于个人爱好而编写的。

Linux 是一套免费使用和自由传播的类 Unix 操作系统，是一个基于 POSIX 和 UNIX 的多用户、多任务、支持多线程和多 CPU 的操作系统。

Linux 能运行主要的 UNIX 工具软件、应用程序和网络协议。它支持 32 位和 64 位硬件。Linux 继承了 Unix 以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。

## Linux 文件基本属性

Linux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。

为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。

在 Linux 中我们通常使用以下两个命令来修改文件或目录的所属用户与权限：

- chown (change ownerp) ： 修改所属用户与组。
- chmod (change mode) ： 修改用户的权限。

在 Linux 中我们可以使用 ll 或者 ls –l 命令来显示一个文件的属性以及文件所属的用户和组，如：

```
[root@www /]# ls -l
total 64
dr-xr-xr-x   2 root root 4096 Dec 14  2012 bin
dr-xr-xr-x   4 root root 4096 Apr 19  2012 boot
```

实例中，bin 文件的第一个属性用 `d` 表示。`d` 在 Linux 中代表该文件是一个目录文件。

在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。

当为 `d` 则是目录
当为 `-` 则是文件；
若是 `l` 则表示为链接文档(link file)；
若是 `b` 则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；
若是 `c` 则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。

接下来的字符中，以三个为一组，且均为 `rwx` 的三个参数的组合。其中， `r` 代表可读(read)、 `w` 代表可写(write)、 `x` 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 - 而已。

### Linux文件属主和属组

对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。

同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。

文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。

因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。

### 更改文件属性

#### 1、chgrp：更改文件属组

```
chgrp [-R] 属组名 文件名
```

#### 2、chown：更改文件属主，也可以同时更改文件属组

```
chown [–R] 属主名 文件名
chown [-R] 属主名:属组名 文件名
```

#### 3、chmod：更改文件9个属性

Linux文件属性有两种设置方法，一种是数字，一种是符号。

Linux 文件的基本权限就有九个，分别是 owner/group/others(拥有者/组/其他) 三种身份各有自己的 read/write/execute 权限。

我们可以使用数字来代表各个权限，各权限的分数对照表如下：

- r:4
- w:2
- x:1

```bash
chmod [-R] 755 文件或目录
# or
chmod u=rwx,g=rx,o=r 文件或目录
```

## Linux 文件与目录管理

- `ls`（英文全拼：list files）: 列出目录及文件名
  - `-a` ：全部的文件，连同隐藏文件( 开头为 . 的文件) 一起列出来(常用)
  - `-d` ：仅列出目录本身，而不是列出目录内的文件数据(常用)
  - `-l` ：长数据串列出，包含文件的属性与权限等等数据；(常用)
- `cd`（英文全拼：change directory）：切换目录
  - `cd -` ：切换到上一个访问的目录
- `pwd`（英文全拼：print work directory）：显示目前的目录
  - `-P` ：显示出确实的路径，而非使用连结 (link) 路径。
- `mkdir`（英文全拼：make directory）：创建一个新的目录
  - `-m` ：配置文件的权限喔！直接配置，不需要看默认权限 (umask) 的脸色～
  - `-p` ：帮助你直接将所需要的目录(包含上一级目录)递归创建起来！
- `rmdir`（英文全拼：remove directory）：删除一个空的目录
- `cp`（英文全拼：copy file）: 复制文件或目录
  - `-a` ：相当於 -pdr 的意思，至於 pdr 请参考下列说明；(常用)
  - `-d` ：若来源档为连结档的属性(link file)，则复制连结档属性而非文件本身；
  - `-f` ：为强制(force)的意思，若目标文件已经存在且无法开启，则移除后再尝试一次；
  - `-i` ：若目标档(destination)已经存在时，在覆盖时会先询问动作的进行(常用)
  - `-l` ：进行硬式连结(hard link)的连结档创建，而非复制文件本身；
  - `-p` ：连同文件的属性一起复制过去，而非使用默认属性(备份常用)；
  - `-r` ：递归持续复制，用於目录的复制行为；(常用)
  - `-s` ：复制成为符号连结档 (symbolic link)，亦即『捷径』文件；
  - `-u` ：若 destination 比 source 旧才升级 destination ！
- `rm`（英文全拼：remove）: 删除文件或目录
  - `-f` ：就是 force 的意思，忽略不存在的文件，不会出现警告信息；
  - `-i` ：互动模式，在删除前会询问使用者是否动作
  - `-r` ：递归删除啊！最常用在目录的删除了！这是非常危险的选项！
- `mv`（英文全拼：move file）: 移动文件与目录，或修改文件与目录的名称
  - `-f` ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；
  - `-i` ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！
  - `-u` ：若目标文件已经存在，且 source 比较新，才会升级 (update)

## Linux 用户和用户组管理

Linux系统是一个多用户多任务的分时操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统。

用户的账号一方面可以帮助系统管理员对使用系统的用户进行跟踪，并控制他们对系统资源的访问；另一方面也可以帮助用户组织文件，并为用户提供安全性保护。

每个用户账号都拥有一个唯一的用户名和各自的口令。

用户在登录时键入正确的用户名和口令后，就能够进入系统和自己的主目录。

### Linux系统用户账号的管理

#### 添加帐号

添加用户账号就是在系统中创建一个新账号，然后为新账号分配用户号、用户组、主目录和登录Shell等资源。刚添加的账号是被锁定的，无法使用。

添加新的用户账号使用 `useradd` 命令，其语法如下：

```
useradd 选项 用户名
```

参数说明：

- 选项
  - `-c` comment 指定一段注释性描述。
  - `-d` 目录 指定用户主目录，如果此目录不存在，则同时使用 `-m` 选项，可以创建主目录。
  - `-g` 用户组 指定用户所属的用户组。
  - `-G` 用户组，用户组 指定用户所属的附加组。
  - `-s` Shell文件 指定用户的登录Shell。
  - `-u` 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。
- 用户名:
  - 指定新账号的登录名。

```bash
# 此命令创建了一个用户sam，其中-d和-m选项用来为登录名sam产生一个主目录 /home/sam（/home为默认的用户主目录所在的父目录）。
useradd –d /home/sam -m sam

# 此命令新建了一个用户gem，该用户的登录Shell是 /bin/sh，它属于group用户组，同时又属于adm和root用户组，其中group用户组是其主组。
useradd -s /bin/sh -g group –G adm,root gem
```

增加用户账号就是在 `/etc/passwd` 文件中为新用户增加一条记录，同时更新其他系统文件如 `/etc/shadow`, `/etc/group` 等。

#### 删除帐号

删除一个已有的用户账号使用userdel命令，其格式如下：

```
userdel 选项 用户名
```

常用的选项是 `-r`，它的作用是把用户的主目录一起删除。

```bash
userdel -r sam
```

#### 修改帐号

修改用户账号就是根据实际情况更改用户的有关属性，如用户号、主目录、用户组、登录Shell等。

修改已有用户的信息使用usermod命令，其格式如下：

```
usermod 选项 用户名
```

常用的选项包括 `-c`, `-d`, `-m`, `-g`, `-G`, `-s`, `-u` 以及 `-o` 等，这些选项的意义与 `useradd` 命令中的选项一样，可以为用户指定新的资源值。

另外，有些系统可以使用选项：`-l` 新用户名

例如：

```bash
# 此命令将用户sam的登录Shell修改为ksh，主目录改为/home/z，用户组改为developer。
usermod -s /bin/ksh -d /home/z –g developer sam
```

#### 用户口令的管理

用户管理的一项重要内容是用户口令的管理。用户账号刚创建时没有口令，但是被系统锁定，无法使用，必须为其指定口令后才可以使用，即使是指定空口令。

指定和修改用户口令的 Shell 命令是 passwd。超级用户可以为自己和其他用户指定口令，普通用户只能用它修改自己的口令。命令的格式为：

```
passwd 选项 用户名
```

- `-l` 锁定口令，即禁用账号。
- `-u` 口令解锁。
- `-d` 使账号无口令。
- `-f` 强迫用户下次登录时修改口令。

### Linux系统用户组的管理

每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理。用户组的管理涉及用户组的添加、删除和修改。组的增加、删除和修改实际上就是对 `/etc/group` 文件的更新。

1、增加一个新的用户组使用 `groupadd` 命令。其格式如下：

```
groupadd 选项 用户组
```

- `-g` GID 指定新用户组的组标识号（GID）。
- `-o` 一般与-g选项同时使用，表示新用户组的GID可以与系统已有用户组的GID相同。

2、删除用户组

```
groupdel 用户组
```

3、修改用户组

```
groupmod 选项 用户组
```

- `-g` GID 为用户组指定新的组标识号。
- `-o` 与 `-g` 选项同时使用，用户组的新GID可以与系统已有用户组的GID相同。
- `-n` 新用户组 将用户组的名字改为新名字

4、切换用户组

```bash
# 这条命令将当前用户切换到root用户组，前提条件是root用户组确实是该用户的主组或附加组。类似于用户账号的管理，用户组的管理也可以通过集成的系统管理工具来完成。
newgrp root
```

### 与用户账号有关的系统文件

/etc/passwd 文件是用户管理工作涉及的最重要的一个文件

Linux系统中的每个用户都在/etc/passwd文件中有一个对应的记录行，它记录了这个用户的一些基本属性。

这个文件对所有用户都是可读的。它的内容类似下面的例子：

```bash
cat /etc/passwd

root:x:0:0:Superuser:/:
daemon:x:1:1:System daemons:/etc:
bin:x:2:2:Owner of system commands:/bin:
auth:x:7:21:Authentication administrator:/tcb/files/auth:
```

从上面的例子我们可以看到，/etc/passwd中一行记录对应着一个用户，每行记录又被冒号(:)分隔为7个字段，其格式和具体含义如下：

```
用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell
```

## Linux 磁盘管理

Linux磁盘管理好坏直接关系到整个系统的性能问题。

Linux磁盘管理常用三个命令为 df、du 和 fdisk。

- `df` ：列出文件系统的整体磁盘使用量
- `du` ：检查磁盘空间使用量
- `fdisk` ：用于磁盘分区

## ln - 软链接与硬链接

硬链接(hard link) ： 可以将它理解为一个 “指向原始文件 inode 的指针”，系统不为它分配独立的 inode 和 文件。所以，硬链接文件与原始文件其实是同一个文件，只是名字不同。我们每添加一个硬链接，该文件的 innode 连接数就会增加 1 ； 而且只有当该文件的 inode 连接数为 0 时，才算彻底被将它删除。因此即便删除原始文件，依然可以通过硬链接文件来访问。需要注意的是，我们不能跨分区对文件进行链接。

软链接(symbolic link) ： 等同于 Windows 系统下的快捷方式。仅仅包括所含链接文件的路径名字。因此能链接目录，也能跨文件系统链接。但是，当删除原始文件后，链接文件也将失效。
